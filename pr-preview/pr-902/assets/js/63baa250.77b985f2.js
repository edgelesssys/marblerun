"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8668],{11287:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"reference/coordinator","title":"Coordinator client API","description":"The Coordinator exposes an HTTP-REST interface, referred to as the Client API.","source":"@site/versioned_docs/version-1.8/reference/coordinator.md","sourceDirName":"reference","slug":"/reference/coordinator","permalink":"/marblerun/pr-preview/pr-902/reference/coordinator","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/marblerun/edit/master/docs/versioned_docs/version-1.8/reference/coordinator.md","tags":[],"version":"1.8","frontMatter":{},"sidebar":"docs","previous":{"title":"Occlum","permalink":"/marblerun/pr-preview/pr-902/building-marbles/occlum"},"next":{"title":"CLI","permalink":"/marblerun/pr-preview/pr-902/reference/cli"}}');var i=s(74848),t=s(28453);const a={},c="Coordinator client API",d={},l=[{value:"Retrieve the Coordinator&#39;s manifest",id:"retrieve-the-coordinators-manifest",level:2},{value:"Returns",id:"returns",level:4},{value:"Returns",id:"returns-1",level:4},{value:"Set the Coordinator&#39;s manifest",id:"set-the-coordinators-manifest",level:2},{value:"Request body",id:"request-body",level:4},{value:"Returns",id:"returns-2",level:4},{value:"Request body",id:"request-body-1",level:4},{value:"Returns",id:"returns-3",level:4},{value:"Retrieve the Coordinator&#39;s SGX quote and certificates",id:"retrieve-the-coordinators-sgx-quote-and-certificates",level:2},{value:"Query parameters",id:"query-parameters",level:4},{value:"Returns",id:"returns-4",level:4},{value:"Returns",id:"returns-5",level:4},{value:"Recover the Coordinator",id:"recover-the-coordinator",level:2},{value:"Request body",id:"request-body-2",level:4},{value:"Returns",id:"returns-6",level:4},{value:"Retrieve MarbleRun managed secrets",id:"retrieve-marblerun-managed-secrets",level:2},{value:"Query parameters",id:"query-parameters-1",level:4},{value:"Returns",id:"returns-7",level:4},{value:"Query parameters",id:"query-parameters-2",level:4},{value:"Returns",id:"returns-8",level:4},{value:"Secret object",id:"secret-object",level:3},{value:"Set secrets",id:"set-secrets",level:2},{value:"Request body",id:"request-body-3",level:4},{value:"Request body",id:"request-body-4",level:4},{value:"User secret object",id:"user-secret-object",level:3},{value:"Verify and sign an SGX quote",id:"verify-and-sign-an-sgx-quote",level:2},{value:"Request body",id:"request-body-5",level:4},{value:"Returns",id:"returns-9",level:4},{value:"Get the current status of the Coordinator",id:"get-the-current-status-of-the-coordinator",level:2},{value:"Returns",id:"returns-10",level:4},{value:"Returns",id:"returns-11",level:4},{value:"Get a log of all performed updates",id:"get-a-log-of-all-performed-updates",level:2},{value:"Returns",id:"returns-12",level:4},{value:"Returns",id:"returns-13",level:4},{value:"Update the manifest",id:"update-the-manifest",level:2},{value:"Request body",id:"request-body-6",level:4},{value:"Returns",id:"returns-14",level:4},{value:"Request body",id:"request-body-7",level:4},{value:"Packages object",id:"packages-object",level:4},{value:"Acknowledge a pending manifest update",id:"acknowledge-a-pending-manifest-update",level:2},{value:"Request body",id:"request-body-8",level:4},{value:"Returns",id:"returns-15",level:4},{value:"Request body",id:"request-body-9",level:4},{value:"Returns",id:"returns-16",level:4},{value:"View a pending manifest update",id:"view-a-pending-manifest-update",level:2},{value:"Returns",id:"returns-17",level:4},{value:"Returns",id:"returns-18",level:4},{value:"Cancel a pending manifest update",id:"cancel-a-pending-manifest-update",level:2},{value:"Returns",id:"returns-19",level:4},{value:"Returns",id:"returns-20",level:4}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{EnterpriseBanner:s,TabItem:r,Tabs:a}=n;return s||u("EnterpriseBanner",!0),r||u("TabItem",!0),a||u("Tabs",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"coordinator-client-api",children:"Coordinator client API"})}),"\n",(0,i.jsx)(n.p,{children:"The Coordinator exposes an HTTP-REST interface, referred to as the Client API."}),"\n",(0,i.jsxs)(n.p,{children:["Responses of the API follow the ",(0,i.jsx)(n.a,{href:"https://github.com/omniti-labs/jsend",children:"JSend specification"}),".\nThis means all endpoints return a JSON object with a ",(0,i.jsx)(n.code,{children:"status"})," field that's either ",(0,i.jsx)(n.code,{children:"success"}),", ",(0,i.jsx)(n.code,{children:"fail"}),", or ",(0,i.jsx)(n.code,{children:"error"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In case of ",(0,i.jsx)(n.code,{children:"success"}),", the response contains a ",(0,i.jsx)(n.code,{children:"data"})," field with the actual response data."]}),"\n",(0,i.jsxs)(n.li,{children:["In case of ",(0,i.jsx)(n.code,{children:"error"}),", the response contains a ",(0,i.jsx)(n.code,{children:"message"})," field with an error message."]}),"\n",(0,i.jsxs)(n.li,{children:["In case of ",(0,i.jsx)(n.code,{children:"fail"}),", the response may contain a ",(0,i.jsx)(n.code,{children:"message"})," field with a human readable message, as well as a ",(0,i.jsx)(n.code,{children:"data"})," field with additional information.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fail"})," is only used in API version 2, and is returned on invalid requests by the client."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The MarbleRun CLI and ",(0,i.jsx)(n.a,{href:"https://pkg.go.dev/github.com/edgelesssys/marblerun/api",children:"the MarbleRun Go SDK"})," use the Client API to interact with the Coordinator.\nIt may also be used directly by applications for programmatic access."]}),"\n",(0,i.jsx)(n.h2,{id:"retrieve-the-coordinators-manifest",children:"Retrieve the Coordinator's manifest"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/manifest\n"})}),(0,i.jsx)(n.p,{children:"Get the currently set manifest."}),(0,i.jsx)(n.p,{children:"The endpoint returns a manifest signature as base64 encoded bytes (signed by the root ECDSA key) and a SHA-256 of the currently set manifest.\nFurther, the manifest itself is returned as base64 encoded bytes.\nAll returned values don't change when a package update has been applied."}),(0,i.jsx)(n.p,{children:"Users can retrieve and inspect the manifest through this endpoint before interacting with the application."}),(0,i.jsx)(n.p,{children:"Example for retrieving the deployed manifest with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl --cacert marblerun.crt \"https://$MARBLERUN/api/v2/manifest\" | jq '.data.ManifestSignature' --raw-output | base64 -d\n"})}),(0,i.jsx)(n.h4,{id:"returns",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifestSignatureRootECDSA"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded ECDSA signature of the manifest signed by the Coordinator's root key."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifestFingerprint"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Hex encoded SHA-256 hash of the manifest."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "manifestSignatureRootECDSA": "bWFuaWZlc3RTaWduYXR1cmVSb290RUNEU0E=",\n        "manifestFingerprint": "c2fd772483c510d49a339ae207588642f46eb8f22537f77d6ac348691a41ba32",\n        "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo="\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /manifest\n"})}),(0,i.jsx)(n.p,{children:"Get the currently set manifest."}),(0,i.jsx)(n.p,{children:"The endpoint returns a manifest signature as base64 encoded bytes (signed by the root ECDSA key) and a SHA-256 of the currently set manifest.\nFurther, the manifest itself is returned as base64 encoded bytes.\nAll returned values don't change when a package update has been applied."}),(0,i.jsx)(n.p,{children:"Users can retrieve and inspect the manifest through this endpoint before interacting with the application."}),(0,i.jsx)(n.p,{children:"Example for requesting the deployed manifest hash with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl --cacert marblerun.crt \"https://$MARBLERUN/manifest\" | jq '.data.ManifestSignature' --raw-output\n"})}),(0,i.jsx)(n.p,{children:"Example for verifying the deployed manifest via the intermediate key signature:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# get manifest signature (signed by coordinator root key)\ncurl --cacert marblerun.crt "https://$MARBLERUN/manifest" | jq \'.data.ManifestSignatureRootECDSA\' --raw-output | base64 -d > manifest.sig\n# extract root public key from coordinator certificate root\nmarblerun certificate root $MARBLERUN\nopenssl x509 -in marblerunRootCA.crt -pubkey -noout > root.pubkey\n# verify signature\nopenssl dgst -sha256 -verify root.pubkey -signature manifest.sig manifest.json\n# verification fails? try to remove newlines from manifest\nawk \'NF {sub(/\\r/, ""); printf "%s",$0;}\' original.manifest.json  > formatted.manifest.json\n'})}),(0,i.jsx)(n.h4,{id:"returns-1",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifestSignatureRootECDSA"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded ECDSA signature of the manifest signed by the Coordinator's root key."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifestSignature"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Hex encoded SHA-256 hash of the manifest."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "manifestSignatureRootECDSA": "bWFuaWZlc3RTaWduYXR1cmVSb290RUNEU0E=",\n        "manifestSignature": "c2fd772483c510d49a339ae207588642f46eb8f22537f77d6ac348691a41ba32",\n        "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo="\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"set-the-coordinators-manifest",children:"Set the Coordinator's manifest"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/manifest\n"})}),(0,i.jsx)(n.p,{children:"Before deploying applications to a MarbleRun deployment, a manifest needs to be set.\nOn success, a key-value mapping for encrypted secrets to be used for recovering the Coordinator in case of disaster recovery is returned.\nThe key matches each supplied key from RecoveryKeys in the Manifest."}),(0,i.jsx)(n.p,{children:"Example for setting the manifest with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --data-binary @manifest-request.json "https://$MARBLERUN/manifest"\n'})}),(0,i.jsx)(n.h4,{id:"request-body",children:"Request body"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo="\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-2",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"recoveryKeys"})," object"]}),"\n",(0,i.jsxs)(n.p,{children:["An optional field that will be present if the manifest contains ",(0,i.jsx)(n.code,{children:"RecoveryKeys"}),".\nKey-value mapping of strings to strings, where the key matches each supplied key from ",(0,i.jsx)(n.code,{children:"RecoveryKeys"})," in the manifest,\nand the value is the base64 encoded encrypted recovery secret."]}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "recoveryKeys": {\n            "recoveryKey1": "ZW5jcnlwdGVkUmVjb3ZlcnlTZWNyZXQxCg==",\n            "recoveryKey2": "ZW5jcnlwdGVkUmVjb3ZlcnlTZWNyZXQyCg=="\n        }\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /manifest\n"})}),(0,i.jsx)(n.p,{children:"Before deploying applications to a MarbleRun deployment, a manifest needs to be set.\nOn success, a key-value mapping for encrypted secrets to be used for recovering the Coordinator in case of disaster recovery is returned.\nThe key matches each supplied key from RecoveryKeys in the Manifest."}),(0,i.jsx)(n.p,{children:"Example for setting the manifest with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --data-binary @manifest.json "https://$MARBLERUN/manifest"\n'})}),(0,i.jsx)(n.h4,{id:"request-body-1",children:"Request body"}),(0,i.jsxs)(n.p,{children:["Raw JSON encoded manifest.\nSee ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/define-manifest",children:"Defining a Manifest"})," for more information."]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "Packages": {\n        "package1": {},\n        "package2": {}\n    },\n    "Marbles": {\n        "marble1": {},\n        "marble2": {}\n    },\n    "Secrets": {},\n    "Users": {},\n    "Roles": {},\n    "TLS": {},\n    "RecoveryKeys": {\n        "recoveryKey1": "-----BEGIN PUBLIC KEY-----\\nMIIBpTANBgk...",\n        "recoveryKey2": "-----BEGIN PUBLIC KEY-----\\nMIIBpTANBgk..."\n    }\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-3",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"recoveryKeys"})," object"]}),"\n",(0,i.jsxs)(n.p,{children:["An optional field that will be present if the manifest contains ",(0,i.jsx)(n.code,{children:"RecoveryKeys"}),".\nKey-value mapping of strings to strings, where the key matches each supplied key from ",(0,i.jsx)(n.code,{children:"RecoveryKeys"})," in the manifest,\nand the value is the base64 encoded encrypted recovery secret."]}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "recoveryKeys": {\n            "recoveryKey1": "ZW5jcnlwdGVkUmVjb3ZlcnlTZWNyZXQxCg==",\n            "recoveryKey2": "ZW5jcnlwdGVkUmVjb3ZlcnlTZWNyZXQyCg=="\n        }\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"retrieve-the-coordinators-sgx-quote-and-certificates",children:"Retrieve the Coordinator's SGX quote and certificates"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/quote[?nonce=<base64_url_encoding(nonce)>]\n"})}),(0,i.jsxs)(n.p,{children:["Retrieves and SGX-DCAP quote from the Coordinator.\nLearn more about DCAP in the ",(0,i.jsx)(n.a,{href:"https://download.01.org/intel-sgx/sgx-dcap/1.21/linux/docs/DCAP_ECDSA_Orientation.pdf",children:"official Intel DCAP orientation"}),"."]}),(0,i.jsx)(n.p,{children:"This endpoint can be used to verify the integrity of the Coordinator and the cluster at any time."}),(0,i.jsx)(n.h4,{id:"query-parameters",children:"Query parameters"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"nonce"})," string (optional)"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 URL encoded nonce to be included in the quote."}),"\n"]}),"\n"]}),(0,i.jsx)(n.h4,{id:"returns-4",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"cert"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"PEM-encoded certificate chain containing the Coordinator's Root CA and Intermediate CA.\nCan be used for trust establishment between a client and the Coordinator."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"quote"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64-encoded SGX quote where the report data is a SHA-256 hash of the Coordinator's root certificate complete ASN.1 DER content and the nonce, if provided:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"report_data = SHA256(coordinator_root_cert + nonce)\n"})}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "cert": "-----BEGIN CERTIFICATE-----\\nMIIBpTANBgk...",\n        "quote": "U0dYIHF1b3RlCg=="\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /quote\n"})}),(0,i.jsxs)(n.p,{children:["Retrieves and SGX-DCAP quote from the Coordinator.\nLearn more about DCAP in the ",(0,i.jsx)(n.a,{href:"https://download.01.org/intel-sgx/sgx-dcap/1.21/linux/docs/DCAP_ECDSA_Orientation.pdf",children:"official Intel DCAP orientation"}),"."]}),(0,i.jsx)(n.p,{children:"This endpoint can be used to verify the integrity of the Coordinator and the cluster at any time."}),(0,i.jsx)(n.h4,{id:"returns-5",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"cert"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"PEM-encoded certificate chain containing the Coordinator's Root CA and Intermediate CA.\nCan be used for trust establishment between a client and the Coordinator."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"quote"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64-encoded SGX quote where the report data is a SHA-256 hash of the Coordinator's root certificate complete ASN.1 DER content:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"report_data = SHA256(coordinator_root_cert)\n"})}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "cert": "-----BEGIN CERTIFICATE-----\\nMIIBpTANBgk...",\n        "quote": "U0dYIHF1b3RlCg=="\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"recover-the-coordinator",children:"Recover the Coordinator"}),"\n",(0,i.jsx)(a,{groupId:"apiVersion",children:(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/recover\n"})}),(0,i.jsx)(n.p,{children:"Recover the Coordinator using decrypted recovery secrets."}),(0,i.jsxs)(n.p,{children:["This API endpoint is only available when the coordinator is in recovery mode.\nBefore you can use the endpoint, you need to decrypt the recovery secret which you may have received when setting the manifest initially.\nSee ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/recover-coordinator",children:"Recovering the Coordinator"})," on how to retrieve the recovery key needed to use this API endpoint correctly."]}),(0,i.jsx)(n.p,{children:"Example for recovering the Coordinator with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -k -X POST --data-binary @recovery_key.json "https://$MARBLERUN/api/v2/recover"\n'})}),(0,i.jsx)(n.h4,{id:"request-body-2",children:"Request body"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"recoverySecret"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded recovery secret."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"recoverySecretSignature"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded RSA PKCS #1 v1.5 signature over the sha256 hash of the RecoverySecret using the private key used to decrypt the recovery secret."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "recoverySecret": "AAECAwQFBgcICQoLDA0ODw==",\n    "recoverySecretSignature": "cmVjb3Zlcnkga2V5IHNpZ25hdHVyZQ=="\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-6",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"remaining"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"Remaining secret shares to be uploaded for recovery to complete."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the success or progress of the recovery process."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "remaining": 2,\n        "message": "Secret was processed successfully. Upload the next secret. Remaining secrets: 2"\n    }\n}\n'})})]})}),"\n",(0,i.jsx)(n.h2,{id:"retrieve-marblerun-managed-secrets",children:"Retrieve MarbleRun managed secrets"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/secrets?s=<secretName1>[&s=<secretName2>...]\n"})}),(0,i.jsxs)(n.p,{children:["Each requests allows specifying one or more secrets in the form of a query string, where each parameter ",(0,i.jsx)(n.code,{children:"s"})," specifies one secret."]}),(0,i.jsxs)(n.p,{children:["A query string for the secrets ",(0,i.jsx)(n.code,{children:"symmetricKeyShared"})," and ",(0,i.jsx)(n.code,{children:"certShared"})," may look like the following:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"s=symmetricKeyShared&s=certShared\n"})}),(0,i.jsxs)(n.p,{children:["This API endpoint only works when ",(0,i.jsx)(n.code,{children:"Users"})," were defined in the manifest.\nThe user connects via mutual TLS using the user client certificate in the TLS Handshake.\nFor more information, look up ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/managing-secrets",children:"Managing secrets"}),"."]}),(0,i.jsxs)(n.p,{children:["Example for retrieving the secrets ",(0,i.jsx)(n.code,{children:"symmetricKeyShared"})," and ",(0,i.jsx)(n.code,{children:"certShared"}),":"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key "https://$MARBLERUN/secrets?s=symmetricKeyShared&s=certShared"\n'})}),(0,i.jsx)(n.h4,{id:"query-parameters-1",children:"Query parameters"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"s"})," string (required) one or more"]}),"\n",(0,i.jsx)(n.p,{children:"Secret name to retrieve."}),"\n"]}),"\n"]}),(0,i.jsx)(n.h4,{id:"returns-7",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"secrets"})," ",(0,i.jsx)(n.a,{href:"#secret-object",children:"object"})]}),"\n",(0,i.jsxs)(n.p,{children:["Key-value mapping of strings to ",(0,i.jsx)(n.a,{href:"#secret-object",children:"secret objects"}),", where the key matches each supplied secret name in the query string."]}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "secrets": {\n            "symmetricKeyShared": {\n                "type": "symmetric-key",\n                "size": 128,\n                "shared": true,\n                "userDefined": false,\n                "private": "QUFBQUFBQUFBQUFBQUFBQQ==",\n                "public": "QUFBQUFBQUFBQUFBQUFBQQ==",\n            },\n            "certShared": {\n                "type": "cert-ecdsa",\n                "size": 256,\n                "shared": true,\n                "userDefined": false,\n                "cert": "LS0tLS1CRU...",\n            },\n        },\n    },\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /secrets?s=<secretName1>[&s=<secretName2>...]\n"})}),(0,i.jsxs)(n.p,{children:["Each requests allows specifying one or more secrets in the form of a query string, where each parameter ",(0,i.jsx)(n.code,{children:"s"})," specifies one secret."]}),(0,i.jsxs)(n.p,{children:["A query string for the secrets ",(0,i.jsx)(n.code,{children:"symmetricKeyShared"})," and ",(0,i.jsx)(n.code,{children:"certShared"})," may look like the following:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"s=symmetricKeyShared&s=certShared\n"})}),(0,i.jsxs)(n.p,{children:["This API endpoint only works when ",(0,i.jsx)(n.code,{children:"Users"})," were defined in the manifest.\nThe user connects via mutual TLS using the user client certificate in the TLS Handshake.\nFor more information, look up ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/managing-secrets",children:"Managing secrets"}),"."]}),(0,i.jsxs)(n.p,{children:["Example for retrieving the secrets ",(0,i.jsx)(n.code,{children:"symmetricKeyShared"})," and ",(0,i.jsx)(n.code,{children:"certShared"}),":"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key "https://$MARBLERUN/secrets?s=symmetricKeyShared&s=certShared"\n'})}),(0,i.jsx)(n.h4,{id:"query-parameters-2",children:"Query parameters"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"s"})," string (required) one or more"]}),"\n",(0,i.jsx)(n.p,{children:"Secret name to retrieve."}),"\n"]}),"\n"]}),(0,i.jsx)(n.h4,{id:"returns-8",children:"Returns"}),(0,i.jsxs)(n.p,{children:["Key-value mapping of strings to ",(0,i.jsx)(n.a,{href:"#secret-object",children:"secret objects"}),", where the key matches each supplied secret name in the query string."]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "symmetricKeyShared": {\n            "type": "symmetric-key",\n            "size": 128,\n            "shared": true,\n            "userDefined": false,\n            "private": "QUFBQUFBQUFBQUFBQUFBQQ==",\n            "public": "QUFBQUFBQUFBQUFBQUFBQQ==",\n        },\n        "certShared": {\n            "type": "cert-ecdsa",\n            "size": 256,\n            "shared": true,\n            "userDefined": false,\n            "cert": "LS0tLS1CRU...",\n        },\n    },\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h3,{id:"secret-object",children:"Secret object"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"type"})," string"]}),"\n",(0,i.jsxs)(n.p,{children:["The type of the secret. One of ",(0,i.jsx)(n.code,{children:"cert-ecdsa"}),", ",(0,i.jsx)(n.code,{children:"cert-ed25519"}),", ",(0,i.jsx)(n.code,{children:"cert-rsa"}),", ",(0,i.jsx)(n.code,{children:"symmetric-key"}),", ",(0,i.jsx)(n.code,{children:"plain"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"size"})," integer"]}),"\n",(0,i.jsx)(n.p,{children:"Size of the key in bits."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For Type ",(0,i.jsx)(n.code,{children:"symmetric-key"}),", this is a multiple of 8."]}),"\n",(0,i.jsxs)(n.li,{children:["For Type ",(0,i.jsx)(n.code,{children:"cert-ecdsa"}),", this maps to a curve supported by Go's crypto library, currently: 224, 256, 384, or 521."]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.code,{children:"cert-ed25519"}),", this is omitted."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"shared"})," bool"]}),"\n",(0,i.jsx)(n.p,{children:"Specifies whether this secret is shared across all marbles, or if it's unique to each marble."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"userDefined"})," bool"]}),"\n",(0,i.jsx)(n.p,{children:"Specifies whether a secret should be generated by the MarbleRun (false),\nor if it will be uploaded by a user at a later point (true)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"cert"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded X.509 certificate."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"validFor"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"Validity of the certificate in days."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"private"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded private key matching the certificate or symmetric key."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"public"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded public key matching the certificate or symmetric key."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"set-secrets",children:"Set secrets"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/secrets\n"})}),(0,i.jsxs)(n.p,{children:["This API endpoint only works when ",(0,i.jsx)(n.code,{children:"Users"})," were defined in the manifest.\nThe user connects via mutual TLS using the user client certificate in the TLS Handshake.\nFor more information, look up ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/managing-secrets",children:"Managing secrets"}),"."]}),(0,i.jsxs)(n.p,{children:["Example for setting secrets from the file ",(0,i.jsx)(n.code,{children:"secrets.json"}),":"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key --data-binary @secrets.json "https://$MARBLERUN/secrets"\n'})}),(0,i.jsx)(n.h4,{id:"request-body-3",children:"Request body"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"secrets"})," object"]}),"\n",(0,i.jsxs)(n.p,{children:["Key-value mapping of strings to ",(0,i.jsx)(n.a,{href:"#user-secret-object",children:"user secret objects"}),", where the key is the name of the secret."]}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "secrets": {\n        "symmetricKeyShared": {\n            "key": "QUFBQUFBQUFBQUFBQUFBQQ==",\n        },\n        "certShared": {\n            "cert": "LS0tLS1CRU...",\n            "public": "LS0tLS1CRU...",\n        },\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /secrets\n"})}),(0,i.jsx)(n.p,{children:"Setting secrets requires uploading them in JSON format."}),(0,i.jsxs)(n.p,{children:["This API endpoint only works when ",(0,i.jsx)(n.code,{children:"Users"})," were defined in the manifest.\nThe user connects via mutual TLS using the user client certificate in the TLS Handshake.\nFor more information, look up ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/managing-secrets",children:"Managing secrets"}),"."]}),(0,i.jsxs)(n.p,{children:["Example for setting secrets from the file ",(0,i.jsx)(n.code,{children:"secrets.json"}),":"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key --data-binary @secrets.json "https://$MARBLERUN/secrets"\n'})}),(0,i.jsx)(n.h4,{id:"request-body-4",children:"Request body"}),(0,i.jsxs)(n.p,{children:["Key-value mapping of strings to ",(0,i.jsx)(n.a,{href:"#user-secret-object",children:"user secret objects"}),", where the key is the name of the secret."]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "symmetricKeyShared": {\n        "key": "QUFBQUFBQUFBQUFBQUFBQQ==",\n    },\n    "certShared": {\n        "cert": "LS0tLS1CRU...",\n        "public": "LS0tLS1CRU...",\n    },\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h3,{id:"user-secret-object",children:"User secret object"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"key"})," string"]}),"\n",(0,i.jsxs)(n.p,{children:["Base64 encoded symmetric-key or arbitrary base64 encoded data for secrets of type ",(0,i.jsx)(n.code,{children:"plain"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"cert"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded X.509 certificate."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"public"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded public key matching the certificate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Only ",(0,i.jsx)(n.code,{children:"key"}),", or ",(0,i.jsx)(n.code,{children:"cert"})," and ",(0,i.jsx)(n.code,{children:"public"})," may be set for a given secret."]}),"\n",(0,i.jsx)(n.h2,{id:"verify-and-sign-an-sgx-quote",children:"Verify and sign an SGX quote"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["This endpoint is disabled by default.\nYou can ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/define-manifest#config",children:"enable it in the manifest"}),"."]})}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/sign-quote\n"})}),(0,i.jsx)(n.p,{children:"Send an SGX quote to the Coordinator for verification.\nIf the quote is valid, the Coordinator will sign the quote using its root ECDSA key, and return the signature with the TCB status of the quote."}),(0,i.jsx)(n.p,{children:"The Coordinator doesn't verify if the quote matches any packages in the configured manifest."}),(0,i.jsx)(n.p,{children:"The signature is created over the SHA-256 hash of the base64-encoded SGX quote and the TCB status:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"signature = ECDSA_sign(root_priv_key, SHA256(base64(SGX_quote) + string(TCB_status)))\n"})}),(0,i.jsx)(n.p,{children:"If the quote is invalid, the Coordinator will return a JSend fail response, which may look like the following:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "fail",\n    "data": {\n        "sgxQuote": "quote verification failed: OE_QUOTE_VERIFICATION_ERROR"\n    },\n    "message": "quote verification failed",\n}\n'})}),(0,i.jsx)(n.h4,{id:"request-body-5",children:"Request body"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sgxQuote"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded SGX quote."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "sgxQuote": "U0dYIHF1b3RlCg=="\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-9",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"signature"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded ECDSA signature of the SHA-256 hash of the base64-encoded SGX quote and the TCB status:"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tcbStatus"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"The TCB status of the SGX quote."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "verificationSignature": "RUNEU0Ffc2lnbihyb290X3ByaXZfa2V5LCBTSEEyNTYoYmFzZTY0KFNHWF9xdW90ZSkgKyBzdHJpbmcoVENCX3N0YXR1cykpKQo=",\n        "tcbStatus": "UpToDate"\n    }\n}\n'})})]}),(0,i.jsx)(r,{value:"v1",label:"v1",children:(0,i.jsx)(n.p,{children:"This API endpoint isn't available in API version 1."})})]}),"\n",(0,i.jsx)(n.h2,{id:"get-the-current-status-of-the-coordinator",children:"Get the current status of the Coordinator"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/status\n"})}),(0,i.jsx)(n.p,{children:"Get the current status of the Coordinator."}),(0,i.jsx)(n.p,{children:"The status indicates the current state of the coordinator, and can be one of the following:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Coordinator is in recovery mode. Either upload a key to unseal the saved state, or set a new manifest. Waiting for user input on ",(0,i.jsx)(n.a,{href:"#recover-the-coordinator",children:"/recover"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Coordinator is ready to accept a manifest on ",(0,i.jsx)(n.a,{href:"#set-the-coordinators-manifest",children:"/manifest"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Coordinator is running correctly and ready to accept marbles through the ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/add-service",children:"Marble API"}),"."]}),"\n"]}),(0,i.jsx)(n.h4,{id:"returns-10",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"status"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"A status code that matches the internal code of the Coordinator's current state."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the current state of the Coordinator."}),"\n"]}),"\n"]})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /status\n"})}),(0,i.jsx)(n.p,{children:"Get the current status of the Coordinator."}),(0,i.jsx)(n.p,{children:"The status indicates the current state of the coordinator, and can be one of the following:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Coordinator is in recovery mode. Either upload a key to unseal the saved state, or set a new manifest. Waiting for user input on ",(0,i.jsx)(n.a,{href:"#recover-the-coordinator",children:"/recover"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Coordinator is ready to accept a manifest on ",(0,i.jsx)(n.a,{href:"#set-the-coordinators-manifest",children:"/manifest"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Coordinator is running correctly and ready to accept marbles through the ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/add-service",children:"Marble API"}),"."]}),"\n"]}),(0,i.jsx)(n.h4,{id:"returns-11",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"statusCode"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"A status code that matches the internal code of the Coordinator's current state."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"statusMessage"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the current state of the Coordinator."}),"\n"]}),"\n"]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"get-a-log-of-all-performed-updates",children:"Get a log of all performed updates"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/update\n"})}),(0,i.jsxs)(n.p,{children:["Returns a structured log of all updates performed via the ",(0,i.jsx)(n.a,{href:"#update-the-manifest",children:(0,i.jsx)(n.code,{children:"/update"})})," or ",(0,i.jsx)(n.a,{href:"#set-secrets",children:(0,i.jsx)(n.code,{children:"/secrets"})})," endpoint, including timestamp, author, and affected resources."]}),(0,i.jsx)(n.h4,{id:"returns-12",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"updateLog"})," array of strings"]}),"\n",(0,i.jsx)(n.p,{children:"A log of all performed updates.\nEach entry in the array is one JSON structured log entry."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "updateLog": [\n            "{\\"time\\":\\"2024-01-01T00:00:00.0\\",\\"update\\":\\"Initial manifest set\\"}"\n        ]\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /update\n"})}),(0,i.jsxs)(n.p,{children:["Returns a structured log of all updates performed via the ",(0,i.jsx)(n.a,{href:"#update-the-manifest",children:(0,i.jsx)(n.code,{children:"/update"})})," or ",(0,i.jsx)(n.a,{href:"#set-secrets",children:(0,i.jsx)(n.code,{children:"/secrets"})})," endpoint, including timestamp, author, and affected resources."]}),(0,i.jsx)(n.h4,{id:"returns-13",children:"Returns"}),(0,i.jsx)(n.p,{children:"A string comprising the log of all performed updates.\nThe log is structured as a JSON array of objects, where each object is a log entry."}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": "{\\"time\\":\\"2024-01-01T00:00:00.0\\",\\"update\\":\\"Initial manifest set\\"}\\n"}"\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"update-the-manifest",children:"Update the manifest"}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/update\n"})}),(0,i.jsxs)(n.p,{children:["This API endpoint only works if ",(0,i.jsx)(n.code,{children:"Users"})," are defined in the Manifest.\nIt requires uploading a manifest containing only the packages to be updated, or, if enabled, a completely new manifest.\nThe Coordinator will verify the manifest and return an error if the manifest is invalid.\nFor more information, have a look at ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/update-manifest",children:"updating a Manifest"}),"."]}),(0,i.jsx)(n.h4,{id:"request-body-6",children:"Request body"}),(0,i.jsx)(n.p,{children:"For package updates:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest, containing only the packages to be updated, or, if enabled, a completely new manifest."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo="\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-14",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingAcknowledgments"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"The number of users that need to acknowledge the update before it's applied."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingUsers"})," array of strings"]}),"\n",(0,i.jsx)(n.p,{children:"An array of user IDs that haven't yet acknowledged the update."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "status": "success",\n    "data": {\n        "missingAcknowledgments": 2,\n        "missingUsers": ["user1", "user2", "user3"]\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /update\n"})}),(0,i.jsxs)(n.p,{children:["This API endpoint only works if ",(0,i.jsx)(n.code,{children:"Users"})," are defined in the Manifest.\nIt requires uploading a manifest containing only the packages to be updated, or, if enabled, a completely new manifest.\nThe Coordinator will verify the manifest and return an error if the manifest is invalid.\nFor more information, have a look at ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/update-manifest",children:"updating a Manifest"}),"."]}),(0,i.jsx)(n.p,{children:"Example for updating the manifest with curl:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key --data-binary @update_manifest.json "https://$MARBLERUN/update"\n'})}),(0,i.jsx)(n.h4,{id:"request-body-7",children:"Request body"}),(0,i.jsx)(n.p,{children:"For package updates:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"packages"})," ",(0,i.jsx)(n.a,{href:"#packages-object",children:"object"})]}),"\n",(0,i.jsx)(n.p,{children:"Key-value mapping of strings to package objects, where the key is the name of the package to be updated."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body for package updates:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "packages": {\n        "package1": {\n            "SecurityVersion": 4,\n        },\n        "package2": {\n            "SecurityVersion": 3,\n        }\n    }\n}\n'})}),(0,i.jsxs)(n.p,{children:["For full manifest updates the request body should contain the full manifest.\nSee ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/define-manifest",children:"Defining a Manifest"})," for more information."]}),(0,i.jsx)(n.h4,{id:"packages-object",children:"Packages object"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SecurityVersion"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"The new security version of the package."}),"\n"]}),"\n"]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"acknowledge-a-pending-manifest-update",children:"Acknowledge a pending manifest update"}),"\n",(0,i.jsx)(s,{}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/update-manifest\n"})}),(0,i.jsx)(n.p,{children:"If multiple users are allowed to perform full manifest updates, acknowledgement is required from all users before the manifest is applied."}),(0,i.jsx)(n.p,{children:"Each user must upload the same manifest to acknowledge the update."}),(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/update-manifest#acknowledging-a-multi-party-update",children:"multi-party updates"})," for more information."]}),(0,i.jsx)(n.h4,{id:"request-body-8",children:"Request body"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo="\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-15",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the success or progress of the update process."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingAcknowledgments"})," int"]}),"\n",(0,i.jsx)(n.p,{children:"The number of users that need to acknowledge the update before it's applied."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingUsers"})," array of strings"]}),"\n",(0,i.jsx)(n.p,{children:"An array of user IDs that haven't yet acknowledged the update."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "message": "2 users still needs to acknowledge the update manifest.",\n        "missingAcknowledgments": 2,\n        "missingUsers": ["user1", "user2", "user3"]\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /update-manifest\n"})}),(0,i.jsx)(n.p,{children:"If multiple users are allowed to perform full manifest updates, acknowledgement is required from all users before the manifest is applied."}),(0,i.jsx)(n.p,{children:"Each user must upload the same manifest to acknowledge the update."}),(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/marblerun/pr-preview/pr-902/workflows/update-manifest#acknowledging-a-multi-party-update",children:"multi-party updates"})," for more information."]}),(0,i.jsx)(n.h4,{id:"request-body-9",children:"Request body"}),(0,i.jsx)(n.p,{children:"Raw JSON encoded manifest."}),(0,i.jsx)(n.p,{children:"Example request body:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "Packages": {\n        "package1": {},\n        "package2": {}\n    },\n    "Marbles": {\n        "marble1": {},\n        "marble2": {}\n    },\n    "Secrets": {},\n    "Users": {},\n    "Roles": {},\n    "TLS": {},\n    "RecoveryKeys": {\n        "recoveryKey1": "-----BEGIN PUBLIC KEY-----\\nMIIBpTANBgk...",\n        "recoveryKey2": "-----BEGIN PUBLIC KEY-----\\nMIIBpTANBgk..."\n    }\n}\n'})}),(0,i.jsx)(n.h4,{id:"returns-16",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the success or progress of the update process."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "message": "2 users still needs to acknowledge the update manifest.",\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"view-a-pending-manifest-update",children:"View a pending manifest update"}),"\n",(0,i.jsx)(s,{}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /api/v2/update-manifest\n"})}),(0,i.jsx)(n.p,{children:"Once a multi-party update has been initiated, users can view the pending manifest update."}),(0,i.jsx)(n.h4,{id:"returns-17",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingUsers"})," array of strings"]}),"\n",(0,i.jsx)(n.p,{children:"An array of user IDs that haven't yet acknowledged the update."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the progress of the update process."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo=",\n        "missingUsers": ["user1", "user2"],\n        "message": "2 users still needs to acknowledge the update manifest."\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /update-manifest\n"})}),(0,i.jsx)(n.p,{children:"Once a multi-party update has been initiated, users can view the pending manifest update."}),(0,i.jsx)(n.h4,{id:"returns-18",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"manifest"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"Base64 encoded manifest."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"missingUsers"})," array of strings"]}),"\n",(0,i.jsx)(n.p,{children:"An array of user IDs that haven't yet acknowledged the update."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message indicating the progress of the update process."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "manifest": "eyJQYWNrYWdlcyI6e30sIk1hcmJsZXMiOnt9fQo=",\n        "missingUsers": ["user1", "user2"],\n        "message": "2 users still needs to acknowledge the update manifest."\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"cancel-a-pending-manifest-update",children:"Cancel a pending manifest update"}),"\n",(0,i.jsx)(s,{}),"\n",(0,i.jsxs)(a,{groupId:"apiVersion",children:[(0,i.jsxs)(r,{value:"v2",label:"v2",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /api/v2/update-cancel\n"})}),(0,i.jsx)(n.p,{children:"If a multi-party update has been initiated, users can cancel the pending manifest update."}),(0,i.jsx)(n.h4,{id:"returns-19",children:"Returns"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"message"})," string"]}),"\n",(0,i.jsx)(n.p,{children:"A human readable message about the status of the update."}),"\n"]}),"\n"]}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": {\n        "message": "Update successfully cancelled."\n    }\n}\n'})})]}),(0,i.jsxs)(r,{value:"v1",label:"v1",children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /update-cancel\n"})}),(0,i.jsx)(n.p,{children:"If a multi-party update has been initiated, users can cancel the pending manifest update."}),(0,i.jsx)(n.h4,{id:"returns-20",children:"Returns"}),(0,i.jsx)(n.p,{children:"A human readable message about the status of the update."}),(0,i.jsx)(n.p,{children:"Example response:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-JSON",children:'{\n    "status": "success",\n    "data": "Update successfully cancelled."\n}\n'})})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var r=s(96540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);