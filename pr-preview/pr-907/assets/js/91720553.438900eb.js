"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[259],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},77893:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"workflows/user-authentication","title":"User authentication","description":"Privileged workflows require a user to authenticate themselves to the MarbleRun Coordinator.","source":"@site/versioned_docs/version-1.8/workflows/user-authentication.md","sourceDirName":"workflows","slug":"/workflows/user-authentication","permalink":"/marblerun/pr-preview/pr-907/workflows/user-authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/marblerun/edit/master/docs/versioned_docs/version-1.8/workflows/user-authentication.md","tags":[],"version":"1.8","frontMatter":{},"sidebar":"docs","previous":{"title":"Backup and restore","permalink":"/marblerun/pr-preview/pr-907/workflows/backup"},"next":{"title":"Update a manifest","permalink":"/marblerun/pr-preview/pr-907/workflows/update-manifest"}}');var s=t(74848),r=t(28453);const a={},o="User authentication",l={},c=[{value:"File-based authentication",id:"file-based-authentication",level:2},{value:"PKCS #11-based authentication",id:"pkcs-11-based-authentication",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"user-authentication",children:"User authentication"})}),"\n",(0,s.jsxs)(n.p,{children:["Privileged workflows require a user to authenticate themselves to the MarbleRun Coordinator.\nThis is done by first ",(0,s.jsx)(n.a,{href:"/marblerun/pr-preview/pr-907/workflows/define-manifest#users",children:"adding a user to the manifest"})," and then using the certificate and matching private key as TLS client credentials when connecting to the Coordinator."]}),"\n",(0,s.jsx)(n.h2,{id:"file-based-authentication",children:"File-based authentication"}),"\n",(0,s.jsxs)(n.p,{children:["With file-based authentication, you need to have access to a private key and certificate as PEM-formatted files.\nFor example, you can generate your credentials using the following ",(0,s.jsx)(n.code,{children:"openssl"})," command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes -keyout admin_private.pem -out admin_certificate.pem\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can then use these files to authenticate with the MarbleRun Coordinator:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"marblerun --cert admin_certificate.pem --key admin_private.pem [COMMAND]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pkcs-11-based-authentication",children:"PKCS #11-based authentication"}),"\n",(0,s.jsxs)(n.p,{children:["The MarbleRun CLI supports authentication with private keys stored in a PKCS #11-compatible device.\nTo load client credentials using PKCS #11, you must provide a ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/ThalesGroup/crypto11@v1.2.6#Config",children:"PKCS #11 config file"}),", which specifies how to access the PKCS #11 token.\nAdditionally, you must provide the ID and/or label of the private key and certificate to the CLI."]}),"\n",(0,s.jsx)(n.p,{children:"The PKCS #11 config file is a JSON file that should specify the following fields:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Path"})," (string) - The full path to the PKCS #11 shared library."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Pin"})," (string) - The PIN (password) to access the token."]}),"\n",(0,s.jsxs)(n.li,{children:["One of:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TokenSerial"})," (string) - Serial number of the token to use."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TokenLabel"})," (string) - Label of the token to use."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SlotNumber"})," (int) - Number of the slot containing the token to use."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The following shows an example for authenticating with a key and certificate stored in a token with the label ",(0,s.jsx)(n.code,{children:"marblerun-token"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "Path": "/usr/lib/softhsm/libsofthsm2.so", # Replace with path to your PKCS #11 shared library\n    "TokenLabel": "marblerun-token",\n    "Pin": "1234" # Replace with your token\'s actual password\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Assuming the key and certificate have the label ",(0,s.jsx)(n.code,{children:"marblerun-key"})," and ",(0,s.jsx)(n.code,{children:"marblerun-cert"})," respectively, invoke the CLI as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"marblerun --pkcs11-config /path/to/pkcs11-config.json --pkcs11-key-label marblerun-key --pkcs11-cert-label marblerun-cert [COMMAND]\n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);