"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5017],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var r=s(96540);const t={},i=r.createContext(t);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:n},e.children)}},40336:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"workflows/managing-secrets","title":"Managing secrets","description":"Users might need to access secrets generated by the Coordinator or pass in secrets to MarbleRun themselves.","source":"@site/versioned_docs/version-1.1/workflows/managing-secrets.md","sourceDirName":"workflows","slug":"/workflows/managing-secrets","permalink":"/marblerun/pr-preview/pr-932/1.1/workflows/managing-secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/marblerun/edit/master/docs/versioned_docs/version-1.1/workflows/managing-secrets.md","tags":[],"version":"1.1","frontMatter":{},"sidebar":"docs","previous":{"title":"Update a manifest","permalink":"/marblerun/pr-preview/pr-932/1.1/workflows/update-manifest"},"next":{"title":"Update a deployment","permalink":"/marblerun/pr-preview/pr-932/1.1/workflows/updates"}}');var t=s(74848),i=s(28453);const c={},a="Managing secrets",o={},d=[{value:"Reading a secret",id:"reading-a-secret",level:2},{value:"Setting a secret",id:"setting-a-secret",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"managing-secrets",children:"Managing secrets"})}),"\n",(0,t.jsx)(n.p,{children:"Users might need to access secrets generated by the Coordinator or pass in secrets to MarbleRun themselves."}),"\n",(0,t.jsx)(n.p,{children:"For example, an application might require an access token, to establish secure connections to an external service.\nWhile setting the token directly in the manifest is an option, this would mean exposing the confidential token to everyone with access to the manifest."}),"\n",(0,t.jsxs)(n.p,{children:["For such cases, MarbleRun allows predefined users to upload secrets that have been predefined in the manifest.\nSimilarly, predefined users can retrieve particular secrets from the Coordinator via the ",(0,t.jsx)(n.code,{children:"/secrets"})," endpoint."]}),"\n",(0,t.jsx)(n.h2,{id:"reading-a-secret",children:"Reading a secret"}),"\n",(0,t.jsx)(n.p,{children:"Authorized users can use the client API to read secrets in JSON format."}),"\n",(0,t.jsxs)(n.p,{children:["For example, the following command requests a secret named ",(0,t.jsx)(n.code,{children:"symmetricKeyShared"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"marblerun secret get symmetricKeyShared $MARBLERUN --cert=admin-cert.pem --key=admin-key.pem --era-config=era.json\n"})}),"\n",(0,t.jsx)(n.p,{children:"If the user has the required permissions, the secret is returned:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"symmetricKeyShared:\n\tType:          symmetric-key\n\tUserDefined:   false\n\tSize:          128\n\tKey:           uVGpoJZTRICLccJiVNt9jA==\n"})}),"\n",(0,t.jsx)(n.h2,{id:"setting-a-secret",children:"Setting a secret"}),"\n",(0,t.jsxs)(n.p,{children:["A user can upload secrets via the HTTP REST API in JSON format. The secrets need to be marked as ",(0,t.jsx)(n.code,{children:"UserDefined"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For secrets of the types ",(0,t.jsx)(n.code,{children:"cert-rsa"}),", ",(0,t.jsx)(n.code,{children:"cert-ecdsa"})," and ",(0,t.jsx)(n.code,{children:"cert-ed25519"})," the CLI supports directly uploading a PEM encoded certificate and key from a file.\nTake for example the ",(0,t.jsx)(n.code,{children:"secret_file.pem"}),"  containing a certificate and corresponding private key:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"-----BEGIN CERTIFICATE-----\nMIICpjC ... zrNxzg==\n-----END CERTIFICATE-----\n\n-----BEGIN PRIVATE KEY-----\nMIICeAI ... 8bu8Z+Fe\n-----END PRIVATE KEY-----\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The CLI will look for the first instance of an encoded certificate and/or key in the file, perform a conversion to JSON format, and upload them to the Coordinator.\nThe name of the secret you are trying to set is specified using the ",(0,t.jsx)(n.code,{children:"--from-pem"})," flag."]}),"\n",(0,t.jsxs)(n.p,{children:["The following command uploads the key and certificate pair stored in the ",(0,t.jsx)(n.code,{children:"secret_file.pem"})," as a secret named ",(0,t.jsx)(n.code,{children:"user-certificate"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"marblerun secret set secret_file.pem $MARBLERUN --from-pem user-certificate --cert=admin-cert.pem --key=admin-key.pem --era-config=era.json\n"})}),"\n",(0,t.jsx)(n.p,{children:"To upload different types, or a batch of secrets, a file with the secrets in JSON format is needed.\nEach entry in the file is a JSON object labeled by the name of the secret and contains values depending on its type:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For the types ",(0,t.jsx)(n.code,{children:"cert-rsa"}),", ",(0,t.jsx)(n.code,{children:"cert-ecdsa"})," and ",(0,t.jsx)(n.code,{children:"cert-ed25519"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Cert"}),": A PEM encoded certificate.\nTo preserve newlines correctly set ",(0,t.jsx)(n.code,{children:"Cert"})," to the output of the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"echo -n $(cat <secret_certificate>.pem | sed '1,1d;$ d' | awk 'NF {sub(/\\r/, \"\"); printf \"%s\\\\n\",$0;}')\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Private"}),": A PEM encoded private key. This may be omitted.\nTo preserve newlines correctly set ",(0,t.jsx)(n.code,{children:"Private"})," to the output of the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"echo -n $(cat <secret_private_key>.pem | sed '1,1d;$ d' | awk 'NF {sub(/\\r/, \"\"); printf \"%s\\\\n\",$0;}')\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["For type ",(0,t.jsx)(n.code,{children:"symmetric-key"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Key: a base64 encoded key, with length matching the size defined in the original manifest"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["For the type ",(0,t.jsx)(n.code,{children:"plain"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Key"}),": arbitrary data in base64 encoding. This may be a key of unspecified length, a confidential config file, or any kind of data only some Marbles and/or users should have access to."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The following gives an example for a file to set the secrets ",(0,t.jsx)(n.code,{children:"userDefinedSymmetricKey"}),", ",(0,t.jsx)(n.code,{children:"userDefinedCert"}),", and ",(0,t.jsx)(n.code,{children:"genericSecret"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'{\n  "userDefinedSymmetricKey": {\n    "Key": "AAECAwQFBgcICQoLDA0ODw=="\n  },\n  "userDefinedCert": {\n    "Cert": "MIIBjDCCATOgAwIBAgICBTkwCgYIKoZIzj0EAwIwMjEwMC4GA1UEAxMnTWFyYmxlcnVuIENvb3JkaW5hdG9yIC0gSW50ZXJtZWRpYXRlIENBMB4XDTIxMDYxNTA4NTY0M1oXDTIxMDYyMjA4NTY0M1owLTEcMBoGA1UEAxMTTWFyYmxlcnVuIFVuaXQgVGVzdDENMAsGA1UEBRMEMTMzNzAqMAUGAytlcAMhAEPOc066G5XmvLizOKTENSR+U9lv3geZ0/a2+XkhJRvDo20wazAOBgNVHQ8BAf8EBAMCAoQwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwLAYDVR0RBCUwI4IJbG9jYWxob3N0hwR/AAABhxAAAAAAAAAAAAAAAAAAAAABMAoGCCqGSM49BAMCA0cAMEQCIGOlRcynaPaj/flSr2ZEvmTmhuvtmTb4QkwPFtxFz3EJAiB77ijxAcJNxPKcKmgMB+c8NORC+6N/St2iP/oX/vqQvg==",\n    "Private": "MC4CAQAwBQYDK2VwBCIEIPlmAOOhAStk8ytxzvekPr8zLaQa9+lxnHK+CizDrMds"\n  },\n  "genericSecret": {\n    "Key": "SGVsbG8gZnJvbSB0aGUgTWFyYmxlcnVuIERvY3MhCg=="\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This file can then be uploaded using the CLI and the users credentials:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"marblerun secret set secret_file.json $MARBLERUN --cert=admin-cert.pem --key=admin-key.pem --era-config=era.json\n"})}),"\n",(0,t.jsx)(n.p,{children:"Subsequently, the secrets can be accessed by marbles and authorized users. If the user lacks permission to set one of the secrets, or a secret the user tried to upload was malformed an error occurs instead."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);